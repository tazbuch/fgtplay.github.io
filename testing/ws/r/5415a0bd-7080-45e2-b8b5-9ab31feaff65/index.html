<!DOCTYPE html><html><head><meta content="text/html;charset=utf-8" http-equiv="Content-Type"><title>Tetris</title><style type="text/css">*{margin:0;padding:0}html{overflow:hidden;height:100%}body{position:absolute;font-family:monospace;overflow:hidden;height:100%;width:100%}.warnings{background-color:red;color:#fff;height:fit-content;width:100%}#tetris{left:50%;top:50%;position:absolute;background:grey}#scene{height:100%;position:absolute;background:#fff}#gameOver{height:100%;position:absolute;background:rgba(0,0,0,.75);z-index:999;color:#ffe100;text-align:center;display:none}#gameOver h1{margin-top:50%}#gameOver a,#gameOver a:visited{color:#66bc29;text-decoration:none}#gameOver h3{color:orange}#side{height:100%;position:absolute;top:0;right:0;text-align:center}#info{width:120px;margin:0 auto}#preview{width:80px;height:80px;background:#000;margin:10px auto}#levelInfo{color:#fff;font-size:18px;margin:10px 0}#level{color:orange;font-size:32px}#scoreInfo{color:#fff;font-size:18px;margin-top:0}#score{color:orange}#rewardInfo{color:#ff0;font-weight:700;height:20px}.invisible{visibility:hidden}.animated{-webkit-animation-duration:1.5s;animation-duration:1.5s;-webkit-animation-fill-mode:both;animation-fill-mode:both}@-webkit-keyframes fadeOutUp{0%{opacity:1}100%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}}@keyframes fadeOutUp{0%{opacity:1}100%{opacity:0;-webkit-transform:translate3d(0,-100%,0);-ms-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}}.fadeOutUp{-webkit-animation-name:fadeOutUp;animation-name:fadeOutUp}</style></head><body><noscript><p class="warnings"><strong>WARNING:</strong>This website requires JavaScript enabled, please enable it in your browser settings and reload this page.</p></noscript><div id="tetris"><canvas id="scene"></canvas><div id="gameOver"><h1>Game Over !</h1><h3>Score:<span id="finalScore">0</span></h3><h2><a href="#" id="restart">Restart</a></h2></div><div id="side"><div id="info"><h1 id="levelInfo">Level:<br><span id="level">1</span></h1><h2 id="scoreInfo">Score:<br><span id="score">0</span></h2><div id="rewardInfo" class="invisible">+<span id="reward">0</span></div><canvas id="preview"></canvas></div></div></div><script type="text/javascript">!function s(h,a,o){function c(i,t){if(!a[i]){if(!h[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(f)return f(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[i]={exports:{}};h[i][0].call(r.exports,function(t){var e=h[i][1][t];return c(e||t)},r,r.exports,s,h,a,o)}return a[i].exports}for(var f="function"==typeof require&&require,t=0;t<o.length;t++)c(o[t]);return c}({1:[function(t,e,i){t("./utils.js");var n=t("./consts.js"),d=n.GRID_LINE_COLOR,s=n.BOX_BORDER_COLOR,v=function(t,e,i,n){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineWidth=1,t.strokeStyle=n,t.stroke(),t.closePath()},r=function(t,e,i,n,r,s){var h=t.getContext("2d"),a=t.width,o=t.height;h.rect(0,0,a,o);var c=h.createLinearGradient(0,0,0,o);c.addColorStop(0,r),c.addColorStop(1,s),h.fillStyle=c,h.fill();for(var f=1;f<i;f++){var u=e*f+.5;v(h,{x:u,y:0},{x:u,y:o},d)}for(f=1;f<n;f++){var l=e*f+.5;v(h,{x:0,y:l},{x:a,y:l},d)}},c=function(t,e,i,n,r){n<0||(t.beginPath(),t.rect(i,n,r,r),t.fillStyle=e,t.fill(),t.strokeStyle=s,t.lineWidth=1,t.stroke(),t.closePath())},h={init:function(t,e){this.scene=t,this.preview=e,this.sceneContext=t.getContext("2d"),this.previewContext=e.getContext("2d"),this.gridSize=t.width/n.COLUMN_COUNT,this.previewGridSize=e.width/n.PREVIEW_COUNT,this.drawScene()},clearScene:function(){this.sceneContext.clearRect(0,0,this.scene.width,this.scene.height)},clearPreview:function(){this.previewContext.clearRect(0,0,this.preview.width,this.preview.height)},drawScene:function(){this.clearScene(),r(this.scene,this.gridSize,n.COLUMN_COUNT,n.ROW_COUNT,n.SCENE_BG_START,n.SCENE_BG_END)},drawMatrix:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++)0!==i[n]&&c(this.sceneContext,i[n],n*this.gridSize,e*this.gridSize,this.gridSize)},drawPreview:function(){r(this.preview,this.previewGridSize,n.PREVIEW_COUNT,n.PREVIEW_COUNT,n.PREVIEW_BG,n.PREVIEW_BG)},drawShape:function(t){if(t)for(var e=t.matrix(),i=this.gridSize,n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++){if(1===e[n][r]){var s=i*(t.x+r),h=i*(t.y+n);c(this.sceneContext,t.color,s,h,i)}}},drawPreviewShape:function(t){if(t){this.clearPreview();for(var e=t.matrix(),i=this.previewGridSize,n=(this.preview.width-i*t.getColumnCount())/2,r=(this.preview.height-i*t.getRowCount())/2,s=0;s<e.length;s++)for(var h=0;h<e[s].length;h++){if(1===e[s][h]){var a=n+i*h,o=r+i*s;c(this.previewContext,t.color,a,o,i)}}}}};e.exports=h},{"./consts.js":2,"./utils.js":5}],2:[function(t,e,i){(i=e.exports={}).COLORS=["#00af9d","#ffb652","#cd66cc","#66bc29","#0096db","#3a7dda","#ffe100"],i.SIDE_WIDTH=120,i.ROW_COUNT=20,i.COLUMN_COUNT=10,i.SCENE_BG_START="#8e9ba6",i.SCENE_BG_END="#5c6975",i.PREVIEW_BG="#2f2f2f",i.PREVIEW_COUNT=6,i.GRID_LINE_COLOR="rgba(255,255,255,0.2)",i.BOX_BORDER_COLOR="rgba(255,255,255,0.5)",i.DEFAULT_INTERVAL=600,i.LEVEL_INTERVAL=12e4},{}],3:[function(t,e,i){var n=t("./utils.js"),r=t("./consts.js"),s=t("./shapes.js"),h=t("./views.js"),a=t("./canvas.js"),o=function(t,e){for(var i=t[0].length,n=e;0<=n;n--)for(var r=0;r<i;r++)t[n][r]=0<n?t[n-1][r]:0},c={maxHeight:700,maxWidth:600};function f(t){this.id=t,this.init()}f.prototype={init:function(t){var e=this.config=n.extend(t,c);this.interval=r.DEFAULT_INTERVAL,h.init(this.id,e.maxWidth,e.maxHeight),a.init(h.scene,h.preview),this.matrix=function(t,e){for(var i=[],n=0;n<t;n++){var r=[];i.push(r);for(var s=0;s<e;s++)r.push(0)}return i}(r.ROW_COUNT,r.COLUMN_COUNT),this.reset(),this._initEvents(),this._fireShape()},reset:function(){this.running=!1,this.isGameOver=!1,this.level=1,this.score=0,this.startTime=(new Date).getTime(),this.currentTime=this.startTime,this.prevTime=this.startTime,this.levelTime=this.startTime,function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)t[e][i]=0}(this.matrix),h.setLevel(this.level),h.setScore(this.score),h.setGameOver(this.isGameOver),this._draw()},start:function(){this.running=!0,window.requestAnimationFrame(n.proxy(this._refresh,this))},pause:function(){this.running=!1,this.currentTime=(new Date).getTime(),this.prevTime=this.currentTime},gamveOver:function(){},_keydownHandler:function(t){var e=this.matrix;if(!t)t=window.event;if(!this.isGameOver&&this.shape)switch(t.keyCode){case 37:this.shape.goLeft(e),this._draw();break;case 39:this.shape.goRight(e),this._draw();break;case 38:this.shape.rotate(e),this._draw();break;case 40:this.shape.goDown(e),this._draw();break;case 32:this.shape.goBottom(e),this._update()}},_restartHandler:function(){this.reset(),this.start()},_initEvents:function(){window.addEventListener("keydown",n.proxy(this._keydownHandler,this),!1),h.btnRestart.addEventListener("click",n.proxy(this._restartHandler,this),!1)},_fireShape:function(){this.shape=this.preparedShape||s.randomShape(),this.preparedShape=s.randomShape(),this._draw(),a.drawPreviewShape(this.preparedShape)},_draw:function(){a.drawScene(),a.drawShape(this.shape),a.drawMatrix(this.matrix)},_refresh:function(){this.running&&(this.currentTime=(new Date).getTime(),this.currentTime-this.prevTime>this.interval&&(this._update(),this.prevTime=this.currentTime,this._checkLevel()),this.isGameOver||window.requestAnimationFrame(n.proxy(this._refresh,this)))},_update:function(){this.shape.canDown(this.matrix)?this.shape.goDown(this.matrix):(this.shape.copyTo(this.matrix),this._check(),this._fireShape()),this._draw(),this.isGameOver=function(t){for(var e=t[0],i=0;i<e.length;i++)if(0!==e[i])return!0;return!1}(this.matrix),h.setGameOver(this.isGameOver),this.isGameOver&&h.setFinalScore(this.score)},_check:function(){var t=function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],r=!0,s=0;s<n.length;s++)r=r&&0!==n[s];r&&e.push(i)}return e}(this.matrix);if(t.length){!function(t,e){for(var i in e)o(t,e[i])}(this.matrix,t);var e=function(t){return t&&t.length?100*t.length:0}(t),i=function(t){return t&&1<t.length?100*Math.pow(2,t.length-1):0}(t);this.score+=e+i,h.setScore(this.score),h.setReward(i)}},_checkLevel:function(){var t=(new Date).getTime();t-this.levelTime>r.LEVEL_INTERVAL&&(this.level+=1,this.interval=function(t){return r.DEFAULT_INTERVAL-60*(t-1)}(this.level),h.setLevel(this.level),this.levelTime=t)}},window.Tetris=f},{"./canvas.js":1,"./consts.js":2,"./shapes.js":4,"./utils.js":5,"./views.js":6}],4:[function(t,e,i){var n=t("./consts.js"),r=n.COLORS,s=n.COLUMN_COUNT;function h(){this.states=[[[1,0],[1,0],[1,1]],[[0,0,1],[1,1,1]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]]],this.x=4,this.y=-3,this.flag="L"}function a(){this.states=[[[0,1],[0,1],[1,1]],[[1,1,1],[0,0,1]],[[1,1],[1,0],[1,0]],[[1,0,0],[1,1,1]]],this.x=4,this.y=-3,this.flag="LR"}function o(){this.states=[[[1,1],[1,1]]],this.x=4,this.y=-2,this.flag="O"}function c(){this.states=[[[1],[1],[1],[1]],[[1,1,1,1]]],this.x=5,this.y=-4,this.flag="I"}function f(){this.states=[[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[0,1,0],[1,1,1]],[[0,1],[1,1],[0,1]]],this.x=4,this.y=-2,this.flag="T"}function u(){this.states=[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]],this.x=4,this.y=-2,this.flag="Z"}function l(){this.states=[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]],this.x=4,this.y=-2,this.flag="ZR"}var d=function(t,e,i){var n,r,s,h=e.length,a=e[0].length,o="rotate"===i?t.getBoxes(t.nextState()):t.getBoxes(t.state);for(var c in o)if(n=o[c],s=r=void 0,r=t.x+n.x,!((s=t.y+n.y)<0||("left"===i?0<=(r-=1)&&r<a&&0==e[s][r]:"right"===i?0<=(r+=1)&&r<a&&0==e[s][r]:"down"===i?(s+=1)<h&&0==e[s][r]:"rotate"===i?s<h&&!e[s][r]:void 0)))return!1;return!0};h.prototype=a.prototype=o.prototype=c.prototype=f.prototype=u.prototype=l.prototype={init:function(){this.color=r[Math.floor(7*Math.random())],this.state=0,this.allBoxes={},this.y=0},getBoxes:function(t){var e=this.allBoxes[t]||[];if(e.length)return e;for(var i=this.matrix(t),n=0;n<i.length;n++)for(var r=i[n],s=0;s<r.length;s++)1===r[s]&&e.push({x:s,y:n});return this.allBoxes[t]=e},matrix:function(t){var e=void 0!==t?t:this.state;return this.states[e]},rotate:function(t){if(d(this,t,"rotate")){this.state=this.nextState();var e=this.getRight();s<=e&&(this.x-=e-s+1)}},getColumnCount:function(){for(var t=this.matrix(),e=0,i=0;i<t.length;i++)e=Math.max(e,t[i].length);return e},getRowCount:function(){return this.matrix().length},getRight:function(){var t=this.getBoxes(this.state),e=0;for(var i in t)e=Math.max(t[i].x,e);return this.x+e},nextState:function(){return(this.state+1)%this.states.length},canDown:function(t){return d(this,t,"down")},goDown:function(t){d(this,t,"down")&&(this.y+=1)},goBottom:function(t){for(;d(this,t,"down");)this.y+=1},goLeft:function(t){d(this,t,"left")&&(this.x-=1)},goRight:function(t){d(this,t,"right")&&(this.x+=1)},copyTo:function(t){for(var e=this.matrix(),i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(1===n[r]){var s=this.x+r,h=this.y+i;0<=s&&s<t[0].length&&0<=h&&h<t.length&&(t[h][s]=this.color)}}},e.exports.randomShape=function(){var t;switch(Math.floor(7*Math.random())){case 0:t=new h;break;case 1:t=new o;break;case 2:t=new u;break;case 3:t=new f;break;case 4:t=new a;break;case 5:t=new l;break;case 6:t=new c}return t.init(),t}},{"./consts.js":2}],5:[function(t,e,i){i=e.exports={};var f=function(t){return"object"==typeof t&&!(t.constructor&&!hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))},u=function(){var t,e,i,n,r,s,h=arguments[0]||{},a=1,o=arguments.length,c=!0;for("boolean"==typeof h&&(c=h,h=arguments[a]||{},a++),"object"!=typeof h&&"function"!=typeof obj&&(h={}),a===o&&(h=this,a--);a<o;a++)if(null!=(r=arguments[a]))for(n in r)t=h[n],h!==(i=r[n])&&(c&&i&&(f(i)||(e=Array.isArray(i)))?(s=e?(e=!1,t&&Array.isArray(t)?t:[]):t&&f(t)?t:{},h[n]=u(c,s,i)):void 0!==i&&(h[n]=i));return h},n=function(t,e){var i=[].slice.call(arguments,2);return n=function(){return t.apply(e||this,i.concat([].slice.call(arguments)))}},r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=r,i.$=function(t){return document.getElementById(t)},i.extend=u,i.proxy=n},{}],6:[function(t,e,i){var n=t("./utils.js"),r=t("./consts.js"),s=n.$,h=s("scene"),a=s("side"),o=s("info"),c=s("preview"),f=s("level"),u=s("score"),l=s("rewardInfo"),d=s("reward"),v=s("gameOver"),w=s("restart"),p=s("finalScore"),g=r.SIDE_WIDTH,m=function(t,e,i){var n=function(t,e){var i=document.documentElement.clientWidth,n=document.documentElement.clientHeight,r={};return n<i?(r.height=Math.min(e,n),r.width=Math.min(r.height/2+g,t)):(r.width=Math.min(t,i),r.height=Math.min(e,n)),r}(e,i),r=t.style;r.height=n.height+"px",r.width=n.width+"px",r.marginTop=-n.height/2+"px",r.marginLeft=-n.width/2+"px",h.height=n.height,h.width=h.height/2;var s=n.width-h.width;a.style.width=s+"px",s<g&&(o.style.width=a.style.width),c.width=80,c.height=80,v.style.width=h.width+"px"},x={init:function(t,e,i){this.container=s(t),this.scene=h,this.preview=c,this.btnRestart=w,m(this.container,e,i),this.scene.focus(),l.addEventListener("animationEnd",function(t){l.className="invisible"})},setScore:function(t){u.innerHTML=t},setFinalScore:function(t){p.innerHTML=t},setLevel:function(t){f.innerHTML=t},setReward:function(t){0<t?(d.innerHTML=t,l.className="fadeOutUp animated"):l.className="invisible"},setGameOver:function(t){v.style.display=t?"block":"none"}};e.exports=x},{"./consts.js":2,"./utils.js":5}]},{},[3])</script><script type="text/javascript">const hasKeyboard = !(("ontouchstart" in window) || window.navigator.msMaxTouchPoints > 0);
		const tetris = document.getElementById("tetris");
		const game = new Tetris('tetris');
		game.start();

		if (!hasKeyboard) {
			const arrowup = new KeyboardEvent("keydown", { keyCode: 38 });
			const arrowdown = new KeyboardEvent("keydown", { keyCode: 40 });
			const arrowleft = new KeyboardEvent("keydown", { keyCode: 37 });
			const arrowright = new KeyboardEvent("keydown", { keyCode: 39 });
			tetris.addEventListener("click", function (e) {
				const rect = e.target.getBoundingClientRect();
				const x = (e.clientX - rect.left) / (rect.right - rect.left);
				const y = (e.clientY - rect.top) / (rect.bottom - rect.top);
				if (y < 0.3)
					window.dispatchEvent(arrowup);
				else if (y > 0.9) {
					window.dispatchEvent(arrowdown);
					window.dispatchEvent(arrowdown);
					window.dispatchEvent(arrowdown);
					window.dispatchEvent(arrowdown);
					window.dispatchEvent(arrowdown);
					window.dispatchEvent(arrowdown);
				} else if (x < 0.5)
					window.dispatchEvent(arrowleft);
				else
					window.dispatchEvent(arrowright);
			});
		}</script></body></html>